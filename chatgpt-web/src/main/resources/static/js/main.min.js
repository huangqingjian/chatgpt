!function(a){function t(){var t=a(window).height()-a(".header").height()-a(".footer").height();a(".content").css("min-height",t)}a(".content").length>0&&t(),a(window).resize(function(){a(".content").length>0&&t()}),a("body").append('<div class="sidebar-overlay"></div>'),a(document).on("click","#mobile_btn",function(){return a("main-wrapper").toggleClass("slide-nav"),a(".sidebar-overlay").toggleClass("opened"),a("html").addClass("menu-opened"),!1}),a(document).on("click",".sidebar-overlay",function(){a("html").removeClass("menu-opened"),a(this).removeClass("opened"),a("main-wrapper").removeClass("slide-nav")}),a(document).on("click","#menu_close",function(){a("html").removeClass("menu-opened"),a(".sidebar-overlay").removeClass("opened"),a("main-wrapper").removeClass("slide-nav")});var e=a(".chat-window");a(window).width()>991?e.removeClass("chat-slide"):e.hasClass("chat-home")&&e.addClass("chat-slide"),a(document).on("click",".chat-window .chat-list a.media",function(){return a(window).width()<=991&&e.addClass("chat-slide"),!1}),a(document).on("click","#back_chat_list",function(){return a(window).width()<=991&&e.removeClass("chat-slide"),!1}),a(".floating").length>0&&a(".floating").on("focus blur",function(t){a(this).parents(".form-focus").toggleClass("focused","focus"===t.type||this.value.length>0)}).trigger("blur");var s=function(a){var t=new Date(a);return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()},i=function(a){var t=new Date(a),e=t.getHours(),s=t.getMinutes();return(e=e>=10?e:"0"+e)+":"+(s=s>=10?s:"0"+s)},l=function(a){var t=a,e=o(),s=c();return a==e?t="今天":a==s&&(t="昨天"),t},o=function(){var a=new Date;return a.getFullYear()+"年"+(a.getMonth()+1)+"月"+a.getDate()},c=function(){var a=new Date;return a.setDate(a.getDate()-1),a.getFullYear()+"年"+(a.getMonth()+1)+"月"+a.getDate()},n=function(){var a=new Date,t=a.getHours(),e=a.getMinutes();return(t=t>=10?t:"0"+t)+":"+(e=e>=10?e:"0"+e)},d=a(".chat-scroll");d.scrollTop(d.prop("scrollHeight"));if(a(".pay-btn").length>0&&a(".pay-btn").click(function(){var t={};t.vipId=a(".vip-card.selected").find("input[name=vipId]").val(),a.ajax({url:"/vip/buy",dataType:"json",data:JSON.stringify(t),type:"post",contentType:"application/json",success:function(t){0==t.code?window.location.href="/vip/success.html":401==t.code?(a("#login .login-header h3").text("请先登录ChatGpt后访问～"),a("#login").modal("toggle")):console.log(t.message)}})}),e.length>0){a.ajax({url:"/chat/list",dataType:"json",type:"get",contentType:"application/json",success:function(t){if(0==t.code){if(t.data&&t.data.length>0)for(var e=0;e<t.data.length;e++){var l='<a href="javascript:void(0);" class="media" id="'+t.data[e].id+'">\t<div class="media-img-wrap">\t\t<div class="avatar avatar-away">\t\t\t<img src="/static/img/comment.png" alt="聊天" class="avatar-img">       </div>   </div>',n=t.data[e].lastest,d="",r="";n&&(d=n.question,h=n.questionTime,void 0,void 0,void 0,void 0,g=o(),p=c(),v=s(h),m=i(h),r=v==g?m:v==p?"昨天 "+m:v+" "+m),l+='<div class="media-body">\t<div>\t\t<div class="user-last-chat">'+d+'</div>   </div>   <div>       <div class="last-chat-time block">'+r+"</div>   </div></div>",l+="</a>",a(".chat-cont-left .chat-scroll").append(l)}}else console.log(t.message);var h,g,p,v,m}});var r=function(){var t=!1;return a.ajax({url:"/chat/create",dataType:"json",type:"post",async:!1,contentType:"application/json",success:function(s){if(0==s.code){a(window).width()<=991&&e.addClass("chat-slide"),a(".chat-cont-left .chat-scroll .media").removeClass("active"),a(".chat-cont-right .chat-header,.chat-cont-right .chat-scroll").removeClass("hide"),a(".chat-cont-right .chat-card-group").addClass("hide");var i='<a href="javascript:void(0);" class="media active" id="'+s.data+'"><div class="media-img-wrap"><div class="avatar avatar-away"><img src="/static/img/comment.png" alt="聊天" class="avatar-img"></div></div><div class="media-body"><div><div class="user-last-chat"></div></div><div><div class="last-chat-time block"></div></div></div></a>';a(".chat-cont-left .chat-scroll").prepend(i);var c=o(),n='<input type="hidden" id="chat-date" value="'+c+'"><ul class="list-unstyled chat-list" id="chat-list"><li class="chat-date">'+l(c)+"</li></ul>";a(".chat-cont-right .chat-scroll").html(n),a(".chat-cont-right .chat-scroll").attr("chatId",s.data),t=!0}else 401==s.code?(a("#login .login-header h3").text("请先登录ChatGpt后访问～"),a("#login").modal("toggle")):console.log(s.message)}}),t};a(".chat-compose").click(function(){r()}),a(".chat-talk").click(function(){r()&&p(a(this).attr("talk"))}),a(".chat-delete").click(function(){var t=a(".chat-cont-right .chat-scroll").attr("chatId");a.ajax({url:"/chat/delete/"+t,dataType:"json",type:"post",contentType:"application/json",success:function(e){0==e.code?(a(".chat-cont-right .chat-header,.chat-cont-right .chat-scroll").addClass("hide"),a(".chat-cont-right .chat-card-group").removeClass("hide"),a(".chat-cont-right .chat-scroll").removeAttr("chatId"),a("#"+t).remove()):console.log(e.message)}})});var h=function(t){a(".chat-cont-left .chat-scroll .media").each(function(){-1==a(this).find(".user-last-chat").text().indexOf(t)&&a(this).addClass("hide")})};a("#chat-search").on("input propertychange",function(){if(a(this).val()){if(a(this).prop("chinese"))return;h(a(this).val())}else a(".chat-cont-left .chat-scroll .media").removeClass("hide")}).on("compositionstart",function(){a(this).prop("chinese",!0)}).on("compositionend",function(){h(a(this).val()),a(this).prop("chinese",!1)}),a(document).on("click",".chat-cont-left .chat-scroll .media",function(){a(this).addClass("active"),a(this).siblings().removeClass("active"),a(".chat-cont-right .chat-header,.chat-cont-right .chat-scroll").removeClass("hide"),a(".chat-cont-right .chat-card-group").addClass("hide"),a(".chat-cont-right .chat-scroll").attr("chatId",a(this).attr("id")),a.ajax({url:"/chat/"+a(this).attr("id")+"/record",dataType:"json",type:"get",contentType:"application/json",success:function(t){if(0==t.code){var e="";if(t.data&&t.data.length>0){for(var o="",c=0;c<t.data.length;c++){var n=s(t.data[c].questionTime);if(n!=o)e+='<li class="chat-date">'+l(n)+"</li>",o=n;e+='<li class="media sent"><div class="media-body"><div class="msg-box"><div><p class="msg">'+t.data[c].question+'</p><ul class="chat-msg-info"><li><div class="chat-time"><span>'+i(t.data[c].questionTime)+"</span></div></li></ul></div></div></div></li>",e+='<li class="media received"><div class="avatar"><img src="/static/img/robot.jpeg" alt="User Image" class="avatar-img rounded-circle"></div><div class="media-body"><div class="msg-box"><div><p class="msg">'+t.data[c].answer+"</p></div></div></div></li>"}a("#chat-date").val(o)}a("#chat-list").html(e),d.scrollTop(d.prop("scrollHeight"))}else console.log(t.message)}})})}a(".msg-send-btn").click(function(){g()});var g=function(){var t=a("input[name=msg]").val();t&&(a(".chat-cont-right .chat-card-group").hasClass("hide")?p(t):r()&&p(t))},p=function(t){if(t){var e=a("#chat-date").val(),s=o();e!=s&&(a("#chat-date").val(s),a("#chat-list").append('<li class="chat-date">'+l(s)+"</li>"));var i=a(".chat-cont-right .chat-scroll").attr("chatId"),c=(v=parseInt(Date.now()/1e3),m=parseInt(1e9*(1+Math.random())),v.toString(16)+m.toString(16));a("input[name=msg]").val("");var r='<li class="media sent"><div class="media-body"><div class="msg-box"><div><p class="msg">'+t+'</p><ul class="chat-msg-info"><li><div class="chat-time"><span>'+n()+"</span></div></li></ul></div></div></div></li>";a("#chat-list").append(r),a("#"+i+" .user-last-chat").text(t),a("#"+i+" .last-chat-time").text(n());var h='<li class="media received"><div class="avatar"><img src="/static/img/robot.jpeg" alt="User Image" class="avatar-img rounded-circle"></div><div class="media-body"><div class="msg-box" id="'+c+'"><div><div class="msg-typing"><span></span><span></span><span></span></div></div></div></div></li>';a("#chat-list").append(h),d.scrollTop(d.prop("scrollHeight"));var g={};g.id=c;var p=[];a("#chat-list .media").each(function(){if(a(this).find("p.msg").length>0){var t={};a(this).hasClass("sent")?t.type=0:a(this).hasClass("received")&&(t.type=1),t.content=a(this).find(".msg").text(),p.push(t)}}),g.contents=p,g.chatId=i,a.ajax({url:"/chat/ask",dataType:"json",data:JSON.stringify(g),type:"post",contentType:"application/json",success:function(t){0==t.code?(a("#"+c).html('<div><p class="msg">'+t.data.content+"</p></div>"),d.scrollTop(d.prop("scrollHeight"))):401==t.code?(a("#login .login-header h3").text("请先登录ChatGpt后访问～"),a("#login").modal("toggle")):403==t.code?(a("#"+c).html('<div><p class="msg">您没有使用次数，去<a class="font-weight-bold font-orange" href="/vip.html">充值</a></p></div>'),d.scrollTop(d.prop("scrollHeight")),a("#vip").modal("toggle")):console.log(t.message)}})}var v,m};if(a(".vip-card").length>0&&(a(".vip-card").click(function(){a(".vip-card").removeClass("selected"),a(this).addClass("selected"),a(".pay-amount").text(a(this).find(".price").attr("price"))}),a(".vip-card").eq(0).trigger("click")),a(".header-login").length>0&&a(".header-login").click(function(){a("#login .login-header h3").text("登录ChatGpt"),a("#login").modal("toggle")}),a(".login-btn").length>0&&a(".login-btn").click(function(){var t=a("input[name=username]").val();if(""!=t&&null!=t){var e=a("input[name=password]").val();if(""!=e&&null!=e){var s={};s.username=t,s.password=e,a.ajax({url:"/login",dataType:"json",data:s,type:"post",success:function(t){0!=t.code?a(".alert-login").html('<div class="alert alert-warning"><a href="#" class="close" data-dismiss="alert">&times;</a>'+t.message+"</div>"):window.location.reload()}})}else a(".alert-login").html('<div class="alert alert-warning"><a href="#" class="close" data-dismiss="alert">&times;</a>密码不能为空～</div>')}else a(".alert-login").html('<div class="alert alert-warning"><a href="#" class="close" data-dismiss="alert">&times;</a>手机号不能为空～</div>')}),a(".profile-save").length>0&&a(".profile-save button").click(function(){a("form .alert").remove();var t=a("input[name=mobile]").val();if(""!=t&&null!=t){var e={};e.mobile=t,e.name=a("input[name=name]").val(),e.face=a("input[name=face]").val(),a.ajax({url:"/user/update",dataType:"json",data:JSON.stringify(e),type:"post",contentType:"application/json",success:function(t){0!=t.code?a('<div class="alert alert-warning"><a href="#" class="close" data-dismiss="alert">&times;</a>'+t.message+"</div>").insertBefore(a(".profile-save")):window.location.reload()}})}else a('<div class="alert alert-warning"><a href="#" class="close" data-dismiss="alert">&times;</a>手机号不能为空～</div>').insertBefore(a(".profile-save"))}),a(".change-password").length>0&&a(".change-password button").click(function(){a("form .alert").remove();var t=a("input[name=password]").val();if(""!=t&&null!=t){var e=a("input[name=newPassword]").val();if(""!=e&&null!=e){var s=a("input[name=confirmPassword]").val();if(""!=s&&null!=s){var i={};i.password=t,i.newPassword=e,i.confirmPassword=s,a.ajax({url:"/user/updatePassword",dataType:"json",data:JSON.stringify(i),type:"post",contentType:"application/json",success:function(t){0!=t.code?a('<div class="alert alert-warning"><a href="#" class="close" data-dismiss="alert">&times;</a>'+t.message+"</div>").insertBefore(a(".change-password")):window.location.reload()}})}else a('<div class="alert alert-warning"><a href="#" class="close" data-dismiss="alert">&times;</a>请输入确认密码～</div>').insertBefore(a(".change-password"))}else a('<div class="alert alert-warning"><a href="#" class="close" data-dismiss="alert">&times;</a>请输入新密码～</div>').insertBefore(a(".change-password"))}else a('<div class="alert alert-warning"><a href="#" class="close" data-dismiss="alert">&times;</a>请输入旧密码～</div>').insertBefore(a(".change-password"))}),a(".logout").length>0&&a(".logout").click(function(){a.ajax({url:"/logout",dataType:"json",contentType:"application/json",type:"post",success:function(a){0==a.code?location.href="/chat.html":console.log(a.message)}})}),a(".widget-profile").length>0&&a.ajax({url:"/user/get",dataType:"json",type:"get",contentType:"application/json",success:function(t){if(0==t.code&&t.data){t.data.face&&a(".widget-profile .profile-img img").attr("src",t.data.face);var e=t.data.mobile;t.data.name&&(e=t.data.name),a(".widget-profile .profile-det-info h3").text(e),a(".widget-profile .profile-det-info h5").text(t.data.desc)}else console.log(t.message)}}),a(".load-more-cost").length>0){var v=1;a(".load-more-cost a").click(function(){m()});var m=function(){a(".load-more-cost a").text("正在加载中..."),a.ajax({url:"/cost/list?page="+v,dataType:"json",type:"post",success:function(t){if(0==t.code){if(t.data&&t.data.list&&t.data.list.length>0){for(var e=0;e<t.data.list.length;e++){var s="<tr><td>"+t.data.list[e].vipName+"</td><td>"+t.data.list[e].costNo+"</td><td>"+t.data.list[e].orderTime+'</td><td class="text-center">'+t.data.list[e].amount+"</td><td>"+t.data.list[e].payTime+'</td><td><span class="badge badge-pill '+(1==t.data.list[e].payStatus?"bg-warning-light":2==t.data.list[e].payStatus?"bg-success-light":"bg-danger-light")+'">'+(1==t.data.list[e].payStatus?"待支付":2==t.data.list[e].payStatus?"已支付":"已取消")+"</span></td></tr>";a("#costs").append(s)}a(".load-more-cost a").text("点击加载")}else 1==v?a(".load-more-cost").html("抱歉，没找到您要的资讯信息～"):a(".load-more-cost").html("已经到底啦～");v+=1}else console.log(t.message)}})};m()}a.ajax({url:"/user/getCurrent",dataType:"json",type:"get",contentType:"application/json",success:function(t){if(0==t.code&&t.data){t.data.face&&a(".logged-item .user-img img,.logged-item .avatar img").attr("src",t.data.face);var e=t.data.mobile;t.data.name&&(e=t.data.name),a(".logged-item .user-text h6").text(e),a(".no-log-item").addClass("hide"),a(".logged-item").removeClass("hide")}else console.log(t.message)}}),a(document).keydown(function(a){if(13==a.keyCode)return g(),!1})}(jQuery);